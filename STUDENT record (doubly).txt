class Node:
    def __init__(self, roll, name, marks):
        self.roll = roll
        self.name = name
        self.marks = marks
        self.prev = None
        self.next = None

class StudentRecord:
    def __init__(self):
        self.head = None

    def add(self, roll, name, marks):
        new_node = Node(roll, name, marks)
        if not self.head:
            self.head = new_node
        else:
            temp = self.head
            while temp.next:
                temp = temp.next
            temp.next = new_node
            new_node.prev = temp

    def delete(self, roll):
        temp = self.head
        while temp:
            if temp.roll == roll:
                if temp.prev:
                    temp.prev.next = temp.next
                else:
                    self.head = temp.next
                if temp.next:
                    temp.next.prev = temp.prev
                return True
            temp = temp.next
        return False

    def update(self, roll, name=None, marks=None):
        temp = self.head
        while temp:
            if temp.roll == roll:
                if name: temp.name = name
                if marks is not None: temp.marks = marks
                return True
            temp = temp.next
        return False

    def search(self, roll):
        temp = self.head
        while temp:
            if temp.roll == roll:
                print(f"Roll: {temp.roll}, Name: {temp.name}, Marks: {temp.marks}")
                return True
            temp = temp.next
        print("Record not found")
        return False

    def sort(self, key="roll", ascending=True):
        if not self.head or not self.head.next:
            return
        changed = True
        while changed:
            changed = False
            temp = self.head
            while temp.next:
                a = temp.roll if key == "roll" else temp.marks
                b = temp.next.roll if key == "roll" else temp.next.marks
                if (ascending and a > b) or (not ascending and a < b):
                    temp.roll, temp.next.roll = temp.next.roll, temp.roll
                    temp.name, temp.next.name = temp.next.name, temp.name
                    temp.marks, temp.next.marks = temp.next.marks, temp.marks
                    changed = True
                temp = temp.next

    def display(self):
        if not self.head:
            print("No records found")
            return
        temp = self.head
        while temp:
            print(f"Roll: {temp.roll}, Name: {temp.name}, Marks: {temp.marks}")
            temp = temp.next

    def display_reverse(self):
        if not self.head:
            print("No records found")
            return
        temp = self.head
        while temp.next:
            temp = temp.next
        while temp:
            print(f"Roll: {temp.roll}, Name: {temp.name}, Marks: {temp.marks}")
            temp = temp.prev

s = StudentRecord()

while True:
    print("\n--- Student Record Management (Doubly Linked List) ---")
    print("1. Add Record")
    print("2. Delete Record")
    print("3. Update Record")
    print("4. Search Record")
    print("5. Sort Records")
    print("6. Display All (Forward)")
    print("7. Display All (Reverse)")
    print("8. Exit")
    ch = input("Enter choice: ")

    if ch == '1':
        r = int(input("Enter Roll No: "))
        n = input("Enter Name: ")
        m = int(input("Enter Marks: "))
        s.add(r, n, m)
        print("Record added successfully")
    elif ch == '2':
        r = int(input("Enter Roll No to delete: "))
        if s.delete(r): print("Record deleted")
        else: print("Record not found")
    elif ch == '3':
        r = int(input("Enter Roll No to update: "))
        n = input("Enter New Name (leave blank to skip): ")
        m_in = input("Enter New Marks (leave blank to skip): ")
        m = int(m_in) if m_in else None
        if s.update(r, n if n else None, m): print("Record updated")
        else: print("Record not found")
    elif ch == '4':
        r = int(input("Enter Roll No to search: "))
        s.search(r)
    elif ch == '5':
        key = input("Sort by (roll/marks): ")
        order = input("Order (asc/desc): ")
        s.sort(key, True if order == "asc" else False)
        print("Records sorted")
    elif ch == '6':
        s.display()
    elif ch == '7':
        s.display_reverse()
    elif ch == '8':
        print("Exiting...")
        break
    else:
        print("Invalid choice")
